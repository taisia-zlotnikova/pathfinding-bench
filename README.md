# Grid Pathfinding Benchmark

---

## Оглавление

1. [Установка и Сборка](#установка-и-сборка)
    - [Требования](#требования)
    - [Пошаговая установка](#пошаговая-установка)
2. [Подготовка данных](#подготовка-данных)
3. [Запуск и Использование](#запуск-и-использование)
    - [1. Режим visual (Визуализация)](#1-режим-visual-визуализация)
    - [2. Режим bench (Быстрый Бенчмарк)](#2-режим-bench-быстрый-бенчмарк)
    - [3. Режим exp (Эксперименты)](#3-режим-exp-эксперименты)
    - [4. Аналитика и Графики](#4-аналитика-и-графики)
4. [Конфигурация](#конфигурация)
5. [Алгоритмы и Эвристики](#алгоритмы-и-эвристики)
6. [Результаты и Метрики](#результаты-и-метрики)
7. [Структура проекта](#структура-проекта)
---

## Установка и Сборка

### Требования
- **OS**: Linux / macOS
- **C++**: Компилятор с поддержкой C++17 (GCC/Clang)
- **CMake**: 3.10+
- **Python**: 3.8+
- **Libs**: `pybind11`, `pandas`, `matplotlib`, `seaborn`

### Пошаговая установка

1.  **Установка Python-зависимостей:**
    ```bash
    pip install -r requirements.txt
    ```

2.  **Сборка C++ модуля:**
    ```bash
    mkdir build
    cd build
    cmake ..
    make
    cd ..
    ```
    *Успех: в папке `build/` появится файл `pathfinding_core.cpython-*.so`.*

3.  **Быстрая настройка (опционально):**
    (Если есть скрипт `setup.sh`, он прописан):
    ```bash
    chmod +x setup.sh
    ./setup.sh
    ```
4.  **Активация виртуального окружения:**
    ```bash
    source venv/bin/activate
    ```

---

## Подготовка данных

Проект использует формат карт `.map` и сценариев `.scen` (MovingAI).
Файлы должны лежать строго в папке `data/`, разделенные по типам задач (папкам).

**Правильная структура:**
```text
data/
├── map/                  # Папка карт
│   ├── maze/             # Тип "maze"
│   │   └── maze512-1-0.map
│   └── random/           # Тип "random"
│       └── random512-10-0.map
└── scen/                 # Папка сценариев
    ├── maze/
    │   └── maze512-1-0.map.scen
    └── random/
        └── random512-10-0.map.scen

```

**Скачать карты можно здесь: [MovingAI Benchmarks](https://movingai.com/benchmarks/grids.html)**

Можно так же создать свои карты и сценарии, сохраняя структуру как в других примерах

---

## Запуск и Использование

В проекте реализована **единая точка входа** через скрипт `scripts/main.py`.
Все команды запускаются из **корневой директории** проекта.

Общий синтаксис:
```bash
python3 scripts/main.py <РЕЖИМ> [ПАРАМЕТРЫ]

```

Доступные режимы:

1. **`visual`** — Визуализация работы алгоритма (ASCII + PNG).
2. **`bench`** — Быстрый тест производительности в консоль.
3. **`exp`** — Массовые эксперименты и сбор данных в CSV.

Параметры:
1. Записаны в файле `config.py`. Можно изменять и они будут применены по дефолту. Смотрите значения по умолчанию заранее в конфиге.
2. Все параметры можно указать в аргументах команды. Аргументы переопределяют значения из `config.py`.
---

### 1. Режим `visual` (Визуализация)

Используйте этот режим, чтобы детально изучить, как алгоритм строит путь на конкретной задаче. Скрипт нарисует карту в консоли и сохранит изображение `path_viz.png`. (Каждую новую визуализацию скрипт перезатирает изображение 'path_viz.png'. Если необходимо, то сохраняйте копию отдельно.)

**Параметры:**

- `--map <путь>`: Путь к файлу карты (.map). от ./data/map
- `--scen <путь>`: Путь к файлу сценария (.scen). Если задан, задачи берутся из него. от ./data/scen
- `--id <int>`: Номер задачи в сценарии (по умолчанию 0).
- `--algo <str>`: Алгоритм. Доступны: `bfs`, `dijkstra`, `astar`, `wastar`.
- `--limit <int>`: Проиграть N задач подряд (режим "слайд-шоу").

**Примеры:**

- **Случайные точки на карте:**
*(Если сценарий не указан, старт и финиш выбираются случайно)*
```bash
python3 scripts/main.py visual --map data/map/maze/maze512-1-0.map --algo astar

```


- **Конкретная задача из сценария:**
*(Запуск задачи №5 на карте из сценария с алгоритмом WA*)*
```bash
python3 scripts/main.py visual --scen data/scen/maze/maze512-1-0.map.scen --id 5 --algo wastar

```


- **Просмотр нескольких задач подряд:**
```bash
python3 scripts/main.py visual --scen data/scen/random/random512-10-0.map.scen --limit 5

```



---

### 2. Режим `bench` (Быстрый Бенчмарк)

Используйте этот режим для быстрой проверки работоспособности кода. Он прогоняет список алгоритмов (настроенный в `config.py`) по сценариям и выводит таблицу результатов прямо в терминал.

**Параметры:**

* `--limit <int>`: Ограничение количества задач на один сценарий (по умолчанию 10).

**Пример:**

```bash
python3 scripts/main.py bench --limit 20

```

---

### 3. Режим `exp` (Эксперименты)

Режим для сбора статистики, для дальнейшего построения графиков и подсчета метрик. Скрипт запускает масштабное тестирование, перебирает карты и сохраняет результаты в CSV файлы в папке `results/`.

! Внимательно прочитайте `scripts/config.py`. Тестирование сложных сценариев занимает много времени. Необходимо проверить тестируемые алгоритмы, 4-8-связность графа и количество задач.

**Параметры:**

- `--mode <str>`: Стратегия выборки задач из сценариев. (Обычно остортированы по возрастанию сложности.)
    - `uniform`: (Рекомендуется) Берет задачи равномерно по сложности (короткие, средние, длинные).
    - `first`: Берет первые N задач.
    - `all`: Прогоняет ВСЕ задачи из файла (Долго. Рекомендуется запускать отдельно, при уверенности в правильности настроек).

- `--count <int>`: Количество задач для тестирования на одной карте (по умолчанию 100). 

- `--map <str>`: Фильтр по имени карты. Если указать (например, `random512-10-0.map`), тесты пройдут только на ней. (в конфиге указано через EXP_TARGET_MAP. по умолначнию)

**Примеры:**

- **Стандартный запуск с параметрами из `config.py`:**
```bash
python3 scripts/main.py exp

```


- **Глубокое тестирование одной карты:**
*(Прогнать абсолютно все задачи на карте random512)*
```bash
python3 scripts/main.py exp --map random512-10-0.map --mode all

```


- **Быстрый "прогревочный" тест:**
```bash
python3 scripts/main.py exp --mode first --count 10

```

**Сохранение данных**

Данные сохраняются в папке `results/` в виде CSV файлов.
```text
results
├── maze                  # Для каждого типа карты своя папка
│   ├── first_10          # Каждый запуск создает свою подпапку с CSV
│   └── single_map_tests 
└── random
    ├── first_10
    └── single_map_tests
```
- сначала попадает в тип задачи
- потом в тип тестирования по 1 карте или множественным
- файлы с названии содержат временную метку

---

### 4. Аналитика и Графики

После того как вы запустили режим `exp` и получили CSV файлы, используйте этот скрипт для построения графиков.

**Команда:**

```bash
python3 scripts/analyze_results.py

```

Скрипт автоматически:

1. Найдет новые CSV файлы в папке `results/`.
2. Построит графики (Время, Память, Trade-off).
3. Сохранит их в PNG рядом с данными. (См. где лежат эти данные)

временная метка дублируется от названия файла CSV.

## Конфигурация

Файл `scripts/config.py` управляет режимом `bench` и общими настройками:

- общие настройки
    - CONNECTIVITY ( для визуализации и тестирования bench)
    - MAP_TYPES
- настройки запусков --mode
    - visual
    - bench
    - exp
- настройки алгоритмов
    - ALGO_REGISTRY
    - EXPERIMENT_ALGORITHMS

---

## Алгоритмы и Эвристики

### Реализованные алгоритмы:

- **BFS**: Поиск в ширину. Оптимален на графах без весов.
- **Dijkstra**: Гарантированно находит кратчайший путь.
- **A\* (A-Star)**: Направленный поиск. Использует эвристику . Оптимален.
- **WA\* (Weighted A\*)**: , где:
    - Жадный алгоритм.
    - Работает быстрее A*, но не гарантирует оптимальность



### Эвристики:

- **Zero**: Для Dijkstra.
- **Manhattan**: . Для 4-связных графов.
- **Euclidean**: 
- **Octile**: Диагональное расстояние. Для 8-связных графов. .

---

## Результаты и Метрики

Результаты сохраняются в `results/`.
В CSV файлах собираются следующие метрики:

- `Success`: Найден ли путь.
- `TimeMS`: Время работы в мс.
- `PathLength`: Длина пути.
- `ExpandedNodes`: Количество раскрытых вершин (показатель эффективности).
- `Suboptimality`: . Показывает, насколько путь хуже идеального.

---

## Структура проекта

```text
.
├── build/                  # Бинарные файлы (C++ .so)
├── src/                    # Исходный код C++
│   ├── PathPlanner.cpp     # Ядро алгоритмов
│   ├── PathPlanner.h       # Заголовки
│   └── bindings.cpp        # Связь с Python
├── scripts/                # Скрипты Python
│   ├── main.py             # Точка входа (visual/bench/exp)
│   ├── run_experiments.py  # Скрипт массового тестирования
│   ├── analyze_results.py  # Построение графиков
│   ├── config.py           # Настройки
│   ├── map_parser.py       # Чтение .map/.scen
│   └── visualizer.py       # Рисование
├── data/                   # Входные данные. Должны быть в строгом порядке
├── results/                # Результаты тестов. Файлы CSV и итоги визуализации
├── requirements.txt        # Зависимости
├── CMakeLists.txt          # Сборка проекта
├── setup.sh                # Скрипт быстрой утсановки (можно вручную)

```