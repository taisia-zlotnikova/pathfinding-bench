# Grid Pathfinding Benchmark

---
## Быстрый старт
- запустить сборку:
```bash
chmod +x setup.sh
./setup.sh
```
- в файле **./scripts/config.py** утановить параметры запуска
```python
TASK_NAME = "maze" # maze, random, my, ...
USE_SCENARIOS = True # True or False - тестировать сценарии или генерировать случайные карты
TASKS_PER_SCENARIO = 100 # количество задач, которые берутся из каждого файла сценария
SCENARIO_FILES = [
    "maze512-2-0.map.scen", # файлы сценариев
]
```

- запустить тестирование:
```bash
python3 scripts/main.py bench
```


---

## Требования

Для сборки и запуска вам понадобятся:

- **C++ компилятор** (с поддержкой C++17)
- **CMake** (версия 3.10+)
- **Python 3.8+**
- Библиотеки Python: `pybind11`, `pandas`, `matplotlib`, `seaborn`, `pillow`

Установка Python-зависимостей:

```bash
pip install -r requirements.txt

```

---

## Сборка проекта

Основная логика поиска пути написана на C++ и подключается к Python как модуль через `pybind11`.

1. **Создайте директорию для сборки:**
```bash
mkdir build
cd build
```
2. **Скомпилируйте проект:**
```bash
cmake ..
make
```
*После успешной сборки в папке `build/` появится файл вида `pathfinding_core.cpython-*.so`.*
3. **Быстрая сборка (опционально):**
Если у вас есть скрипт `setup.sh`:
```bash
chmod +x setup.sh
./setup.sh
```



---

## Подготовка данных

Проект использует формат карт `.map` и сценариев `.scen` из библиотеки **MovingAI**.

1. Скачайте карты и сценарии с [MovingAI Benchmarks](https://movingai.com/benchmarks/grids.html).


2. Разместите их в папке `data/`, сохраняя структуру подпапок для типов задач (например, `maze`, `random`, `room`):

```text
data/
├── map/
│   └── maze/
│       └── maze512-1-0.map
└── scen/
    └── maze/
        └── maze512-1-0.map.scen

```
3. Можно создать свои карты и сценарии, сохраняя структуру как в других примерах

---

## Использование

Все скрипты находятся в папке `scripts/`. Запускать из **корневой директории** проекта.

### 1. Визуализация одного пути (`visual`)

Позволяет увидеть работу алгоритма на конкретной карте или задаче из сценария.

**Синтаксис:**

```bash
python3 scripts/main.py visual --map <путь_к_карте> --algo <алгоритм>

```

**Примеры:**

- **Случайные точки на карте:** (так как не задан сценарий)
```bash
python3 scripts/main.py visual --map data/map/maze/maze512-1-0.map --algo astar

```

- **Конкретная задача из сценария:**
```bash
# Запуск задачи #5 из сценария с использованием WA*
python3 scripts/main.py visual --scen data/scen/maze/maze512-1-0.map.scen --id 5 --algo wastar

```

- **Массовый просмотр задач сценария:**
```bash
python3 scripts/main.py visual --scen data/scen/maze/maze512-1-0.map.scen --limit 5

```

*Доступные алгоритмы (`--algo`): `bfs`, `dijkstra`, `astar`, `wastar`.*

---

### 2. Сбор метрик и тестирование (`bench`)

Запускает массовое тестирование алгоритмов на наборе сценариев и сохраняет результаты в CSV.

```bash
python3 scripts/collect_metrics.py --type <тип_карт>

```

- **`--type`**: Имя подпапки в `data/scen` (например, `maze`, `random`).
- Скрипт автоматически найдет все `.scen` файлы в этой папке, загрузит соответствующие карты и прогонит все алгоритмы.

**Результат:** Файл `results/benchmark_results.csv` с метриками:

- Time (ms) 
- Path Length 
- Expanded Nodes 
- Suboptimality (%) 



---

### 3. Анализ результатов (Графики)

Строит графики сравнения алгоритмов (Boxplots) на основе собранного CSV файла.

```bash
python3 scripts/analyze_results.py

```

**Результат:** Графики сохраняются в папку `results/plots/`:

* `time_comparison.png` — сравнение времени работы.
* `nodes_comparison.png` — количество раскрытых вершин.
* `suboptimality.png` — анализ оптимальности пути для взвешенных алгоритмов (WA*).

---

## Конфигурация

Основные параметры алгоритмов настраиваются в файле `scripts/config.py`:

- **`CONNECTIVITY`**: Связность графа.
    - `4`: Только ортогональные переходы (Up, Down, Left, Right).
    - `8`: Включая диагонали (с проверкой corner cutting).


- **`BENCHMARK_ALGORITHMS`**: Список алгоритмов для тестирования. Можно добавить свои конфигурации WA* с разными весами.


- **`TASKS_PER_SCENARIO`**: Количество задач, которые берутся из каждого файла сценария (для ускорения тестов).

---

## Структура проекта

```text
.
├── build/                 # Скомпилированный C++ модуль (.so)
├── src/                   # Исходный код C++
│   ├── PathPlanner.cpp    # Реализация A*, BFS, Dijkstra
│   ├── PathPlanner.h      # Заголовки и структуры данных
│   └── bindings.cpp       # Pybind11 обвязка
├── scripts/               # Python скрипты
│   ├── main.py            # Точка входа для визуализации
│   ├── collect_metrics.py # Скрипт для массового бенчмарка
│   ├── analyze_results.py # Построение графиков
│   ├── config.py          # Глобальные настройки
│   └── visualizer.py      # Отрисовка карт
├── data/                  # Карты и сценарии MovingAI
├── results/               # Выходные данные (CSV и графики)
└── CMakeLists.txt         # Конфигурация сборки

```

## Алгоритмы и Эвристики

Реализованы следующие алгоритмы:

1. **BFS**: Поиск в ширину (гарантирует оптимальность на невзвешенном графе). Но может выдавать некорректные(более короткие) пути на 8-связных графах, так как считает диагональ длиной 1
2. **Dijkstra**: Дейкстра (A* с нулевой эвристикой).

3. **A***: Классический A* с эвристикой.

4. **WA*** (Weighted A*): A* с весом эвристики  (быстрее, но не гарантирует оптимальность). (чем больше параметр, тем быстрее может работать, но при этом находить менее оптимальные пути)

Поддерживаемые эвристики:

- `Manhattan`:  
- `Euclidean`:  
- `Octile`: