# Grid Pathfinding Benchmark

## Оглавление
- [Быстрый старт](#быстрый-старт)
    - [Установка и сборка](#установка-и-сборка)
    - [3 варианта запуска](#3-варианта-запуска)

---
## Быстрый старт
### Установка и сборка
```bash
chmod +x setup.sh
./setup.sh
source venv/bin/activate
```

### 3 варианта запуска:
- **visual** - визуализация одной карты и пути (сценарий или случайне точки)
- **bench** - тестирование алгоритмов на сценариях
    - вывод результатов в консоль
    - можно для быстрой проверки корректности
    - для быстрого тестирования по разным задачам
    - не очень показательно при малых данных, простых задачах
- **run_experiments** - запуск экспериментов с различными параметрами
    - собирает cvs файл
    - можно построить графики
    - хорош для большого тестирования для сбора метрик

- запустить тестирование:
```bash
python3 scripts/main.py bench
```

- в файле **./scripts/config.py** утановить параметры запуска
```python
TASK_NAME = "maze" # maze, random, my, ...
USE_SCENARIOS = True # True or False - тестировать сценарии или генерировать случайные карты
TASKS_PER_SCENARIO = 100 # количество задач, которые берутся из каждого файла сценария
SCENARIO_FILES = [
    "maze512-2-0.map.scen", # файлы сценариев
]
```


---

## Требования

Для сборки и запуска вам понадобятся:

- **C++ компилятор** (с поддержкой C++17)
- **CMake** (версия 3.10+)
- **Python 3.8+**
- Библиотеки Python: `pybind11`, `pandas`, `matplotlib`, `seaborn`, `pillow`

Установка Python-зависимостей:

```bash
pip install -r requirements.txt

```

---

## Сборка проекта

Основная логика поиска пути написана на C++ и подключается к Python как модуль через `pybind11`.

1. **Создайте директорию для сборки:**
```bash
mkdir build
cd build
```
2. **Скомпилируйте проект:**
```bash
cmake ..
make
```
*После успешной сборки в папке `build/` появится файл вида `pathfinding_core.cpython-*.so`.*
3. **Быстрая сборка (опционально):**
Если у вас есть скрипт `setup.sh`:
```bash
chmod +x setup.sh
./setup.sh
```



---

## Подготовка данных

Проект использует формат карт `.map` и сценариев `.scen` из библиотеки **MovingAI**.

1. Скачайте карты и сценарии с [MovingAI Benchmarks](https://movingai.com/benchmarks/grids.html).
2. Разместите их в папке `data/`, сохраняя структуру подпапок для типов задач (например, `maze`, `random`, `room`):

```text
data/
├── map/
│   └── maze/
│       └── maze512-1-0.map
└── scen/
    └── maze/
        └── maze512-1-0.map.scen

```
3. Можно создать свои карты и сценарии, сохраняя структуру как в других примерах

---

## Использование

Все скрипты находятся в папке `scripts/`. Запускать из **корневой директории** проекта.
```
scripts/
├── analyze_results.py       # Построение графиков
├── benchmark_tester.py      # Тестирование алгоритмов на сценариях
├── config.py                # Параметры запуска: тип карт, алгоритмы, сценарии, количество задач
├── main.py                  # Точка входа
├── map_parser.py            # Парсинг карт и сценариев
└── visualizer.py            # Отрисовка карты и пути в командную строку и в .png
```

### 1. Визуализация одного пути (`visual`)

Позволяет увидеть работу алгоритма на конкретной карте или задаче из сценария.

**Синтаксис:**

```bash
python3 scripts/main.py visual --map <путь_к_карте> --algo <алгоритм>

```

**Примеры:**

- **Случайные точки на карте:** (так как не задан сценарий)
```bash
python3 scripts/main.py visual --map data/map/maze/maze512-1-0.map --algo astar

```

- **Конкретная задача из сценария:** (задаем путь к сценарию и номер задачи. к карте можно не прописывать, она ясна из сценария)
```bash
python3 scripts/main.py visual --scen data/scen/maze/maze512-1-0.map.scen --id 5 --algo wastar

```

- **Массовый просмотр задач сценария:**
```bash
python3 scripts/main.py visual --scen data/scen/maze/maze512-1-0.map.scen --limit 5

```

*Доступные алгоритмы (`--algo`): `bfs`, `dijkstra`, `astar`, `wastar`.*

---

# TODO

---

## Конфигурация

Основные параметры алгоритмов настраиваются в файле `scripts/config.py`:

- **`CONNECTIVITY`**: Связность графа.
    - `4`: Только ортогональные переходы (Up, Down, Left, Right).
    - `8`: Включая диагонали (с проверкой corner cutting).

- **`BENCHMARK_ALGORITHMS`**: Список алгоритмов для тестирования. Можно добавить свои конфигурации WA* с разными весами.

- **`TASKS_PER_SCENARIO`**: Количество задач, которые берутся из каждого файла сценария (для ускорения тестов).
(так как на больших картах сложные сценарии отрабатывают долго. (в 1 сценарии по карте млжет быть порядка 10.000 пар точек старт-финиш))

---

## Структура проекта

```text
.
├── build/                  # Скомпилированный C++ модуль (.so)
├── src/                    # Исходный код C++
│   ├── PathPlanner.cpp     # Реализация A*, BFS, Dijkstra
│   ├── PathPlanner.h       # Заголовки и структуры данных
│   └── bindings.cpp        # Pybind11 обвязка
├── scripts/ 
|   ├── analyze_results.py  # Построение графиков
|   ├── benchmark_tester.py # Тестирование алгоритмов на сценариях
|   ├── config.py           # Параметры запуска: тип карт, алгоритмы, сценарии, количество задач
|   ├── main.py             # Точка входа
|   ├── map_parser.py       # Парсинг карт и сценариев
|   └── visualizer.py       # Отрисовка карты и пути в командную строку и в .png
├── data/                   # Карты и сценарии MovingAI
├── results/                # Выходные данные (CSV и графики)
└── CMakeLists.txt          # Конфигурация сборки

```

## Алгоритмы и Эвристики

Реализованы следующие алгоритмы:

1. **BFS**: Поиск в ширину (гарантирует оптимальность на невзвешенном графе). Но может выдавать некорректные(более короткие) пути на 8-связных графах, так как считает диагональ длиной 1
2. **Dijkstra**: Дейкстра (A* с нулевой эвристикой).

3. **A***: Классический A* с эвристикой.

4. **WA*** (Weighted A*): A* с весом эвристики  (быстрее, но не гарантирует оптимальность). (чем больше параметр, тем быстрее может работать, но при этом находить менее оптимальные пути)

Поддерживаемые эвристики:

- `Manhattan`:  
- `Euclidean`:  
- `Octile`: