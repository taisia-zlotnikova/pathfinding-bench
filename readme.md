# Grid Pathfinding Benchmark

---

## Оглавление

1. [Установка и Сборка](#-установка-и-сборка)
3. [Подготовка данных](#-подготовка-данных)
4. [Режимы запуска](#-режимы-запуска)
    - [1. Визуализация (Visual)](#1-визуализация-visual)
    - [2. Быстрый тест (Bench)](#2-быстрый-тест-bench)
    - [3. Полные эксперименты (Experiments)](#3-полные-эксперименты-experiments)
    - [4. Аналитика (Analytics)](#4-аналитика-analytics)
5. [Конфигурация](#-конфигурация)
6. [Алгоритмы и Эвристики](#-алгоритмы-и-эвристики)
7. [Результаты и Метрики](#-результаты-и-метрики)
8. [Структура проекта](#-структура-проекта)

---

## Установка и Сборка

### Требования
* **OS**: Linux / macOS
* **C++**: Компилятор с поддержкой C++17 (GCC/Clang)
* **CMake**: 3.10+
* **Python**: 3.8+
* **Libs**: `pybind11`, `pandas`, `matplotlib`, `seaborn`

### Пошаговая установка

1.  **Установка Python-зависимостей:**
    ```bash
    pip install -r requirements.txt
    ```

2.  **Сборка C++ модуля:**
    ```bash
    mkdir build
    cd build
    cmake ..
    make
    cd ..
    ```
    *Успех: в папке `build/` появится файл `pathfinding_core.cpython-*.so`.*

3.  **Быстрая настройка (опционально):**
    (Если есть скрипт `setup.sh`, он прописан):
    ```bash
    chmod +x setup.sh
    ./setup.sh
    ```
4.  **Активация виртуального окружения:**
    ```bash
    source venv/bin/activate
    ```

---

## Подготовка данных

Проект использует формат карт `.map` и сценариев `.scen` (MovingAI).
Файлы должны лежать строго в папке `data/`, разделенные по типам задач (папкам).

**Правильная структура:**
```text
data/
├── map/                  # Папка карт
│   ├── maze/             # Тип "maze"
│   │   └── maze512-1-0.map
│   └── random/           # Тип "random"
│       └── random512-10-0.map
└── scen/                 # Папка сценариев
    ├── maze/
    │   └── maze512-1-0.map.scen
    └── random/
        └── random512-10-0.map.scen

```

*Скачать карты можно здесь: [MovingAI Benchmarks*](https://movingai.com/benchmarks/grids.html)

Можно так же создать свои карты и сценарии, сохраняя структуру как в других примерах

---

## Режимы запуска

Все скрипты запускаются из **корня проекта**.

### 1. Визуализация (Visual)

**Файл:** `scripts/main.py`
**Цель:** Детально посмотреть, как работает алгоритм на одной задаче. Рисует карту в консоли (если она достаточно мала) и сохраняет(в любом случае) изображение в `path_viz.png`.

```bash
python3 scripts/main.py visual [параметры]

```

**Параметры:**

| Флаг | Описание | Пример |
| --- | --- | --- |
| `--map` | Путь к карте (.map). (если не задан сценарий, то берутся случайные точки) | `--map data/map/maze/m1.map` |
| `--scen` | Путь к сценарию (.scen). Если задан, задачи берутся из него. | `--scen data/scen/maze/m1.map.scen` |
| `--algo` | Алгоритм (`bfs`, `dijkstra`, `astar`, `wastar`). | `--algo wastar` |
| `--id` | Номер задачи в сценарии (по умолчанию 0). | `--id 5` |
| `--limit` | Если ID не задан, проиграть N задач подряд. | `--limit 5` |

**Примеры:**

* *Случайные точки на карте:* `python3 scripts/main.py visual --map data/map/maze/maze512-1-0.map`
* *Конкретная задача:* `python3 scripts/main.py visual --scen data/scen/maze/maze512-1-0.map.scen --id 42`  (сам подобрал карту по сценарию)

---

### 2. Быстрый тест (Bench)

**Файл:** `scripts/main.py`
**Цель:** Быстро проверить, что всё работает, и получить таблицу результатов в консоль.

```bash
python3 scripts/main.py bench --limit 10
```

*Настройки для этого режима (какие карты и алгоритмы брать) лежат в `scripts/config.py`.*

---

### 3. Полные эксперименты (Experiments)

**Файл:** `scripts/run_experiments.py`
**Цель:** Собрать большую статистику для отчета. Прогоняет тысячи задач, сохраняет результаты в CSV.

```bash
python3 scripts/run_experiments.py

```

**Настройка (внутри файла `run_experiments.py`):**

* `SAMPLING_MODE`:
* `'uniform'` — берет задачи разной сложности равномерно (рекомендуется).
* `'first'` — берет первые N задач (обычно самые простые).
* `'all'` — прогоняет все задачи (долго!).


* `TARGET_MAP_NAME`: Имя конкретной карты (например, `"maze512-1-0.map"`). Если `None`, тестирует все карты в папке.
* `SAMPLING_COUNT`: Сколько задач тестировать на одной карте.

**Результат:** Создает CSV файл в папке `results/<тип>/<режим>/`.

---

### 4. Аналитика (Analytics)

**Файл:** `scripts/analyze_results.py`
**Цель:** Превратить сухие CSV таблицы в красивые графики для отчета.

```bash
python3 scripts/analyze_results.py

```

Скрипт сам находит новые CSV файлы в папке `results/` и генерирует рядом с ними PNG-изображения:

1. **Time Comparison**: Сравнение скорости.
2. **Nodes Comparison**: Сравнение потребления памяти (раскрытые узлы).
3. **Trade-off**: График "Цена скорости" (как сильно падает точность при ускорении WA*).

---

## Конфигурация

Файл `scripts/config.py` управляет режимом `bench` и общими настройками:

```python
CONNECTIVITY = 8           # 4 (Manhattan) или 8 (Octile)
USE_SCENARIOS = True       # Использовать файлы или генерировать рандом
TASKS_PER_SCENARIO = 100   # Лимит задач для bench режима
BENCHMARK_ALGORITHMS = [...] # Список алгоритмов для bench

```

---

## Алгоритмы и Эвристики

### Реализованные алгоритмы:

1. **BFS**: Поиск в ширину. Оптимален на графах без весов.
2. **Dijkstra**: Гарантированно находит кратчайший путь.
3. **A* (A-Star)**: Направленный поиск. Использует эвристику . Оптимален.
4. **WA* (Weighted A*)**: , где .
* Жадный алгоритм.
* Работает быстрее A*, но может найти путь чуть длиннее оптимального.



### Эвристики:

* **Zero**: Для Dijkstra.
* **Manhattan**: . Для 4-связных графов.
* **Euclidean**: .
* **Octile**: Диагональное расстояние. Идеально для 8-связных графов. .

---

## Результаты и Метрики

Результаты сохраняются в `results/`.
В CSV файлах собираются следующие метрики:

* `Success`: Найден ли путь.
* `TimeMS`: Время работы в мс.
* `PathLength`: Длина пути.
* `ExpandedNodes`: Количество раскрытых вершин (показатель эффективности).
* `Suboptimality`: . Показывает, насколько путь хуже идеального.

---

## Структура проекта

```text
.
├── build/                  # Бинарные файлы (C++ .so)
├── src/                    # Исходный код C++
│   ├── PathPlanner.cpp     # Ядро алгоритмов
│   ├── PathPlanner.h       # Заголовки
│   └── bindings.cpp        # Связь с Python
├── scripts/                # Скрипты Python
│   ├── main.py             # Точка входа (visual/bench)
│   ├── run_experiments.py  # Скрипт массового тестирования
│   ├── analyze_results.py  # Построение графиков
│   ├── config.py           # Настройки
│   ├── map_parser.py       # Чтение .map/.scen
│   └── visualizer.py       # Рисование
├── data/                   # Входные данные
├── results/                # Результаты тестов
├── requirements.txt        # Зависимости
└── CMakeLists.txt          # Сборка проекта
```