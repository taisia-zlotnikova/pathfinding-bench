# Grid Pathfinding Benchmark

---

## Оглавление

1. [Установка и Сборка](#установка-и-сборка)
    - [Требования](#требования)
    - [Пошаговая установка](#пошаговая-установка)
2. [Подготовка данных](#подготовка-данных)
3. [Запуск и Использование](#запуск-и-использование)
    - [1. Режим visual (Визуализация)](#1-режим-visual-визуализация)
    - [2. Режим bench (Быстрый Бенчмарк)](#2-режим-bench-быстрый-бенчмарк)
    - [3. Режим exp (Эксперименты)](#3-режим-exp-эксперименты)
    - [4. Аналитика и Графики](#4-аналитика-и-графики)
4. [Конфигурация](#конфигурация)
5. [Алгоритмы и Эвристики](#алгоритмы-и-эвристики)
6. [Результаты и Метрики](#результаты-и-метрики)
7. [Структура проекта](#структура-проекта)
---

## Установка и Сборка

### Требования
* **OS**: Linux / macOS
* **C++**: Компилятор с поддержкой C++17 (GCC/Clang)
* **CMake**: 3.10+
* **Python**: 3.8+
* **Libs**: `pybind11`, `pandas`, `matplotlib`, `seaborn`

### Пошаговая установка

1.  **Установка Python-зависимостей:**
    ```bash
    pip install -r requirements.txt
    ```

2.  **Сборка C++ модуля:**
    ```bash
    mkdir build
    cd build
    cmake ..
    make
    cd ..
    ```
    *Успех: в папке `build/` появится файл `pathfinding_core.cpython-*.so`.*

3.  **Быстрая настройка (опционально):**
    (Если есть скрипт `setup.sh`, он прописан):
    ```bash
    chmod +x setup.sh
    ./setup.sh
    ```
4.  **Активация виртуального окружения:**
    ```bash
    source venv/bin/activate
    ```

---

## Подготовка данных

Проект использует формат карт `.map` и сценариев `.scen` (MovingAI).
Файлы должны лежать строго в папке `data/`, разделенные по типам задач (папкам).

**Правильная структура:**
```text
data/
├── map/                  # Папка карт
│   ├── maze/             # Тип "maze"
│   │   └── maze512-1-0.map
│   └── random/           # Тип "random"
│       └── random512-10-0.map
└── scen/                 # Папка сценариев
    ├── maze/
    │   └── maze512-1-0.map.scen
    └── random/
        └── random512-10-0.map.scen

```

*Скачать карты можно здесь: [MovingAI Benchmarks*](https://movingai.com/benchmarks/grids.html)

Можно так же создать свои карты и сценарии, сохраняя структуру как в других примерах

---

## Запуск и Использование

В проекте реализована **единая точка входа** через скрипт `scripts/main.py`.
Все команды запускаются из **корневой директории** проекта.

Общий синтаксис:
```bash
python3 scripts/main.py <РЕЖИМ> [ПАРАМЕТРЫ]

```

Доступные режимы:

1. **`visual`** — Визуализация работы алгоритма (ASCII + PNG).
2. **`bench`** — Быстрый тест производительности в консоль.
3. **`exp`** — Массовые эксперименты и сбор данных в CSV.

---

### 1. Режим `visual` (Визуализация)

Используйте этот режим, чтобы детально изучить, как алгоритм строит путь на конкретной задаче. Скрипт нарисует карту в консоли и сохранит изображение `path_viz.png`.

**Параметры:**

* `--map <путь>`: Путь к файлу карты (.map).
* `--scen <путь>`: Путь к файлу сценария (.scen). Если задан, задачи берутся из него.
* `--id <int>`: Номер задачи в сценарии (по умолчанию 0).
* `--algo <str>`: Алгоритм. Доступны: `bfs`, `dijkstra`, `astar`, `wastar`.
* `--limit <int>`: Проиграть N задач подряд (режим "слайд-шоу").

**Примеры:**

* **Случайные точки на карте:**
*(Если сценарий не указан, старт и финиш выбираются случайно)*
```bash
python3 scripts/main.py visual --map data/map/maze/maze512-1-0.map --algo astar

```


* **Конкретная задача из сценария:**
*(Запуск задачи №5 на карте из сценария с алгоритмом WA*)*
```bash
python3 scripts/main.py visual --scen data/scen/maze/maze512-1-0.map.scen --id 5 --algo wastar

```


* **Просмотр нескольких задач подряд:**
```bash
python3 scripts/main.py visual --scen data/scen/random/random512-10-0.map.scen --limit 5

```



---

### 2. Режим `bench` (Быстрый Бенчмарк)

Используйте этот режим для быстрой проверки работоспособности кода. Он прогоняет список алгоритмов (настроенный в `config.py`) и выводит таблицу результатов прямо в терминал.

**Параметры:**

* `--limit <int>`: Ограничение количества задач на один сценарий (по умолчанию 10).

**Пример:**

```bash
python3 scripts/main.py bench --limit 20

```

---

### 3. Режим `exp` (Эксперименты)

Используйте этот режим для сбора статистики и написания отчета. Скрипт запускает масштабное тестирование, перебирает карты и сохраняет результаты в CSV файлы в папке `results/`.

**Параметры:**

* `--mode <str>`: Стратегия выборки задач.
* `uniform`: (Рекомендуется) Берет задачи равномерно по сложности (короткие, средние, длинные).
* `first`: Берет первые N задач.
* `all`: Прогоняет ВСЕ задачи из файла (может быть долго!).


* `--count <int>`: Количество задач для тестирования на одной карте (по умолчанию 100).
* `--map <str>`: Фильтр по имени карты. Если указать (например, `random512-10-0.map`), тесты пройдут только на ней.

**Примеры:**

* **Стандартный запуск (для отчета):**
*(Равномерная выборка 100 задач на всех картах)*
```bash
python3 scripts/main.py exp

```


* **Глубокое тестирование одной карты:**
*(Прогнать абсолютно все задачи на карте random512)*
```bash
python3 scripts/main.py exp --map random512-10-0.map --mode all

```


* **Быстрый "прогревочный" тест:**
```bash
python3 scripts/main.py exp --mode first --count 10

```



---

### 4. Аналитика и Графики

После того как вы запустили режим `exp` и получили CSV файлы, используйте этот скрипт для построения графиков.

**Команда:**

```bash
python3 scripts/analyze_results.py

```

Скрипт автоматически:

1. Найдет новые CSV файлы в папке `results/`.
2. Построит графики (Время, Память, Trade-off).
3. Сохранит их в PNG рядом с данными.


## Конфигурация

Файл `scripts/config.py` управляет режимом `bench` и общими настройками:

```python
CONNECTIVITY = 8           # 4 (Manhattan) или 8 (Octile)
USE_SCENARIOS = True       # Использовать файлы или генерировать рандом
TASKS_PER_SCENARIO = 100   # Лимит задач для bench режима
BENCHMARK_ALGORITHMS = [...] # Список алгоритмов для bench

```

---

## Алгоритмы и Эвристики

### Реализованные алгоритмы:

1. **BFS**: Поиск в ширину. Оптимален на графах без весов.
2. **Dijkstra**: Гарантированно находит кратчайший путь.
3. **A* (A-Star)**: Направленный поиск. Использует эвристику . Оптимален.
4. **WA* (Weighted A*)**: , где .
* Жадный алгоритм.
* Работает быстрее A*, но может найти путь чуть длиннее оптимального.



### Эвристики:

* **Zero**: Для Dijkstra.
* **Manhattan**: . Для 4-связных графов.
* **Euclidean**: .
* **Octile**: Диагональное расстояние. Идеально для 8-связных графов. .

---

## Результаты и Метрики

Результаты сохраняются в `results/`.
В CSV файлах собираются следующие метрики:

* `Success`: Найден ли путь.
* `TimeMS`: Время работы в мс.
* `PathLength`: Длина пути.
* `ExpandedNodes`: Количество раскрытых вершин (показатель эффективности).
* `Suboptimality`: . Показывает, насколько путь хуже идеального.

---

## Структура проекта

```text
.
├── build/                  # Бинарные файлы (C++ .so)
├── src/                    # Исходный код C++
│   ├── PathPlanner.cpp     # Ядро алгоритмов
│   ├── PathPlanner.h       # Заголовки
│   └── bindings.cpp        # Связь с Python
├── scripts/                # Скрипты Python
│   ├── main.py             # Точка входа (visual/bench)
│   ├── run_experiments.py  # Скрипт массового тестирования
│   ├── analyze_results.py  # Построение графиков
│   ├── config.py           # Настройки
│   ├── map_parser.py       # Чтение .map/.scen
│   └── visualizer.py       # Рисование
├── data/                   # Входные данные
├── results/                # Результаты тестов
├── requirements.txt        # Зависимости
└── CMakeLists.txt          # Сборка проекта
```