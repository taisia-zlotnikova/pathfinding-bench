## Описание
Скрипт сравнивает классический поиск на графах (C++, CPU) и параллельный тензорный поиск в ширину (PyTorch, GPU). Задачи равномерно выбираются из файлов сценариев (.scen), а размер пакета задач для видеокарты рассчитывается динамически, чтобы не допустить переполнения памяти.


## Запуск

```
./setup.sh
source venv/bin/activate
python3 ./scripts/main.py bench-gpu
```

## Аргументы запуска
- ``--radius <int>:`` 
    - Радиус локального окна вокруг агента (по умолчанию: 10). 
    - Итоговый размер окна вычисляется как (2R + 1) x (2R + 1). Чем больше радиус, тем больше работы выполняет CPU. (так как по умолчанию ищет до всех клеток в окне)

- ``--target_tasks <int>:`` 
    - Количество пар "агент-цель" для тестирования на каждой карте (по умолчанию: 20). 
    - Задачи выбираются из .scen файла равномерно, чтобы захватить маршруты разной длины и сложности.

- ``--batch_size <int>:`` 
    - Размер батчей для gpu. По умолчанию 128

- ``--files_limit <int>:`` 
    - Максимальное количество файлов карт/сценариев, которые берутся из каждой папки data/map/* (по умолчанию: 3). Полезно для быстрого прогона.

- ``--map <str>:`` 
    - Название конкретного файла карты (например, random512-10-0.map). 
    - Если указано, бенчмарк запустится только для неё.

- ``--fast_break / --no-fast_break``: 
    - Управление оптимизацией "ранней остановки" на CPU (по умолчанию включена).
    - Если оставить по умолчанию, алгоритм C++ прервет поиск, как только найдет пути для всех свободных клеток внутри окна агента.
    - Если передать флаг --no-fast_break, оптимизация отключится. CPU будет вынужден просчитать матрицу расстояний для всей карты целиком. Это ставит CPU и GPU в математически равные условия для честного сравнения чистой вычислительной мощности.

### Примеры использования:
Быстрый тест по умолчанию:
```Bash
python3 ./scripts/main.py bench-gpu
```

Жесткий стресс-тест на 5000 задач с batch_size=64:
```Bash
python3 ./scripts/main.py bench-gpu --target_tasks 5000 --batch_size 64
```
Честное "End-to-End" сравнение полного обхода конкретной карты (отключаем раннюю остановку CPU):
```Bash
python3 ./scripts/main.py bench-gpu --map random512-10-0.map --no-fast_break --target_tasks 500
```
## Что будет происходить при запуске?
- Скрипт просканирует ваши директории data/map/ и data/scen/.
- Для каждой подходящей карты он равномерно выберет заданное число сценариев (target_tasks).
- Проведет "прогрев" (warmup) GPU для выделения памяти.
- Замерит время расчета окон батчами на GPU и последовательно в цикле на CPU.
- Выведет в консоль подробную таблицу

## Вывод результатов
- Названия протестированных карт, кол-во целей по каждой карте, радиус, бюджет vram
- По каждой карте:
    - информацию о ней (размер, выбранный чанк)
    - время на cpu, gpu
- Сравнительную информацию (отношения времен)

### Пример вывода
```
fast_break = True
Целей на карту: 20 (Uniform) | Радиус: 10 | VRAM Бюджет: 2048 MB
-----------------------------------------------------------------------------------------------
Карта                     | Размер     | Чанк   | CPU (сек)    | GPU (сек)    | Ускорение 
-----------------------------------------------------------------------------------------------
maze512-1-0.map           | 512x512    | 1024   | 0.7326       | 1.6160       | 0.45x
maze512-1-1.map           | 512x512    | 1024   | 0.8016       | 2.5807       | 0.31x
random512-10-0.map        | 512x512    | 1024   | 1.7661       | 0.2784       | 6.34x
random512-20-0.map        | 512x512    | 1024   | 1.4605       | 0.2889       | 5.06x
random512-40-0.map        | 512x512    | 1024   | 0.6832       | 0.4270       | 1.60x
Moscow_0_256.map          | 256x256    | 2048   | 0.3492       | 0.0702       | 4.98x
Moscow_0_1024.map         | 1024x1024  | 256    | 5.6221       | 1.9136       | 2.94x
Moscow_0_512.map          | 512x512    | 1024   | 1.3596       | 0.3023       | 4.50x
-----------------------------------------------------------------------------------------------
ИТОГО:
Общее время CPU: 12.7750 сек
Общее время GPU: 7.4770 сек
Среднее ускорение: 1.71x
```

